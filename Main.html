<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madurai Pandian Travels Statement</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @media print {
            .online-section, .whatsapp-btn, .print-btn, .btn, .add-row-btn { 
                display: none !important; 
            }
            body { 
                background: white !important; 
                color: black !important; 
                padding: 20px !important;
                font-size: 14px !important;
            }
            .header h1::before,
            .header h1::after { 
                content: "" !important; 
            }
            input, select, textarea {
                border: none !important;
                background: transparent !important;
                box-shadow: none !important;
                padding-left: 0 !important;
                appearance: none !important;
            }
            .form-control:disabled, .form-control[readonly] { 
                background: transparent !important; 
            }
            .table-bordered td, .table-bordered th { 
                border-color: #000 !important; 
                padding: 4px !important;
            }
            .summary-card { 
                border: 1px solid #000 !important;
                margin: 10px 0 !important;
            }
            .header { 
                border-bottom: 2px solid #000 !important;
                padding: 10px !important;
            }
            .print-title {
                display: block !important;
                font-size: 24px !important;
                margin-bottom: 15px !important;
            }
            .no-print { display: none !important; }
            @page { margin: 20px; }

            /* Vertical stack for header fields */
            .print-vertical .col-md-4 {
                width: 100% !important;
                flex: 0 0 100% !important;
                max-width: 100% !important;
                margin-bottom: 8px !important;
            }
            
            /* Remove emojis from labels */
            .form-label::before {
                content: "" !important;
                margin-right: 0 !important;
            }
        }

        .header { background: #2c3e50; color: white; padding: 1rem; }
        .table-responsive { overflow-x: auto; }
        .total-row { background: #f8f9fa; font-weight: bold; }
        .summary-card { background: #e9ecef; padding: 1rem; margin: 1rem 0; }
        .print-title { display: none; }
        input[type="number"] { text-align: right; }
        button { margin: 0.25rem; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header text-center">
            <h1><span class="no-print">üöå</span> Madurai Pandian Travels Statement <span class="no-print">üí∏</span></h1>
            <div class="print-title">Ans Travels Official Statement</div>
        </div>

        <!-- Header Fields - Horizontal Stack in Print -->
<div class="row mt-3 d-flex flex-row print-horizontal">
    <div class="col-md-4">
        <label class="form-label">üìÖ Date</label>
        <input type="date" class="form-control" id="date">
    </div>
    <div class="col-md-4">
        <label class="form-label">üöõ Vehicle No & Time</label>
        <input type="text" class="form-control" id="vehicleNo">
    </div>
    <div class="col-md-4">
        <label class="form-label">üë§ Staff</label>
        <input type="text" class="form-control" id="staff">
    </div>
</div>

<!-- CSS to Enforce Horizontal Layout in Print -->
<style>
@media print {
    .print-horizontal {
        display: flex !important;
        flex-direction: row !important;
        justify-content: space-between;
        align-items: center;
    }
    .print-horizontal .col-md-4 {
        flex: 1;
        margin-right: 10px;
    }
}
</style>

<!-- Seat Info - Table Format & Centered -->
<div class="container mt-3">
    <table class="table table-bordered text-center print-table">
        <thead>
            <tr>
                <th>üí∫ Online Seats</th>
                <th>üé´ Manual Seats</th>
                <th>ü™ë Vacant Seats</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="number" class="form-control text-center online-seat"></td>
                <td><input type="number" class="form-control text-center manual-seat"></td>
                <td><input type="number" class="form-control text-center vacant-seat"></td>
            </tr>
        </tbody>
    </table>
</div>

<!-- CSS to Enforce Table Format in Print -->
<style>
@media print {
    .print-table {
        width: 100%;
        border-collapse: collapse;
    }
    .print-table th, .print-table td {
        border: 1px solid black;
        padding: 10px;
        text-align: center;
    }
    .print-table input {
        width: 100%;
        text-align: center;
        border: none;
        outline: none;
    }
}
</style>


        <!-- Route Table -->
        <div class="table-responsive mt-3">
            <table class="table table-bordered" id="routeTable">
                <thead class="table-dark">
                    <tr><th>Route</th><th>Manual Tickets</th><th>Price</th><th>Total Amount</th></tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                    <tr class="total-row">
                        <td>Total</td>
                        <td id="totalTickets">0</td>
                        <td></td>
                        <td id="totalAmount">0</td>
                    </tr>
                </tfoot>
            </table>
            <button class="btn btn-sm btn-success add-row-btn" onclick="addRow()">‚ûï Add Route</button>
        </div>

        <!-- Collection Summary -->
        <div class="summary-card">
            <h4>üí∞ Collection Summary</h4>
            <div class="row">
                <div class="col-md-6">
                    <p>Manual Collection: ‚Çπ<span id="manualCollection">0</span></p>
                    <div class="online-section">
                        <p>Online Collection: ‚Çπ<input type="number" id="onlineCollection" class="form-control"></p>
                        <p>Online Commission (5%): ‚Çπ<span id="onlineCommission">0</span></p>
                    </div>
                </div>
                <div class="col-md-6">
                    <p>Manual Commission (10%): ‚Çπ<span id="manualCommission">0</span></p>
                    <p>PC Amount: ‚Çπ<input type="number" id="pcAmount" class="form-control"></p>
                    <p>Advance: ‚Çπ<input type="number" id="advance" class="form-control"></p>
                </div>
            </div>
            <div class="total-row p-2">
                <p>Total Commission: ‚Çπ<span id="totalCommission">0</span></p>
                <p>Balance: ‚Çπ<span id="balance">0</span></p>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="text-center mb-3">
            <button class="btn btn-primary print-btn" onclick="preparePrint()">üñ®Ô∏è Generate PDF Statement</button>
            <button class="btn btn-success whatsapp-btn" onclick="shareWhatsApp()">üí¨ Send via WhatsApp</button>
        </div>
    </div>

    <script>
        function addRow() {
            const tbody = document.querySelector('#routeTable tbody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" class="form-control route"></td>
                <td><input type="number" class="form-control tickets"></td>
                <td><input type="number" class="form-control price"></td>
                <td><input type="number" class="form-control total" readonly></td>
            `;
            tbody.appendChild(row);
            addRowListeners(row);
        }

        function addRowListeners(row) {
            const tickets = row.querySelector('.tickets');
            const price = row.querySelector('.price');
            const total = row.querySelector('.total');
            
            const updateTotal = () => {
                total.value = tickets.value * price.value;
                updateGrandTotals();
            };
            
            tickets.addEventListener('input', updateTotal);
            price.addEventListener('input', updateTotal);
        }

        function updateGrandTotals() {
            let totalTickets = 0;
            let totalAmount = 0;
            
            document.querySelectorAll('#routeTable tbody tr').forEach(row => {
                const tickets = parseFloat(row.querySelector('.tickets').value) || 0;
                const total = parseFloat(row.querySelector('.total').value) || 0;
                totalTickets += tickets;
                totalAmount += total;
            });
            
            document.getElementById('totalTickets').textContent = totalTickets;
            document.getElementById('totalAmount').textContent = totalAmount;
            updateCollectionSummary(totalAmount);
        }

        function updateCollectionSummary(manualCollection) {
            const onlineCollection = parseFloat(document.getElementById('onlineCollection').value) || 0;
            const pcAmount = parseFloat(document.getElementById('pcAmount').value) || 0;
            const advance = parseFloat(document.getElementById('advance').value) || 0;
            
            const manualCommission = manualCollection * 0.10;
            const onlineCommission = onlineCollection * 0.05;
            const totalCommission = manualCommission + onlineCommission + pcAmount;
            const balance = manualCollection - (totalCommission + advance);
            
            document.getElementById('manualCollection').textContent = manualCollection;
            document.getElementById('manualCommission').textContent = manualCommission.toFixed(2);
            document.getElementById('onlineCommission').textContent = onlineCommission.toFixed(2);
            document.getElementById('totalCommission').textContent = totalCommission.toFixed(2);
            document.getElementById('balance').textContent = balance.toFixed(2);
        }

        function shareWhatsApp() {
            const balance = document.getElementById('balance').textContent;
            const message = encodeURIComponent(
                `üöç *Madurai Pandian Travels Statement*\n\n` +
                `üìÖ Date: ${document.getElementById('date').value}\n` +
                `üöõ Vehicle No & Time: ${document.getElementById('vehicleNo').value}\n` +
                `üë§ Staff: ${document.getElementById('staff').value}\n` +
                 `üßë‚ÄçüíºManual: ${document.querySelector('.manual-seat').value} | ` +
                  `üåêOnline: ${document.querySelector('.online-seat').value} | ` +
                `üí∫Vacant: ${document.querySelector('.vacant-seat').value}\n\n` +
                `üìä Total Collection: ‚Çπ${document.getElementById('totalAmount').textContent}\n` +
                `ü™ô Total Commission: ‚Çπ${document.getElementById('totalCommission').textContent}\n` +
                `üí∞ Balance: ‚Çπ${balance}\n\n` +
                `_Generated via ANS Travels_`
            );
            window.open(`https://wa.me/?text=${message}`);
        }

        function preparePrint() {
            document.querySelectorAll('input').forEach(input => {
                input.setAttribute('readonly', 'true');
                if (input.type === 'number' && input.value) {
                    input.value = parseFloat(input.value).toLocaleString('en-IN');
                }
            });
            
            window.print();
            
            document.querySelectorAll('input').forEach(input => {
                input.removeAttribute('readonly');
                if (input.type === 'number' && input.value) {
                    input.value = input.value.replace(/,/g, '');
                }
            });
        }

        // Initialize first row
        addRow();
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', updateGrandTotals);
        });
    </script>
</body>
</html>